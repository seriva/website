## Cursor Rules: Portfolio Website (ES6 Modules SPA)

Keep it fast, simple, and secure. Minimal build tooling with Microtastic. Modular ES6 architecture.

### Core Principles
- **Namespace Pattern**: Export single object per module: `export const ModuleName = { method1() {}, method2() {} }`
  - Example: `UI.closeMobileMenu()`, `Context.get()`, `Loaders.loadBlogPage()`
  - All modules follow this pattern consistently
- Use `html\`...\`` templates everywhere; all user content auto-escapes
- Use `${safe(trustedHtml)}` only for trusted, internal HTML strings
- Call `await Context.init()` to load content; access via `Context.get()` (cached)
- Route with URL params: `?blog`, `?project=id`, `?page=id`
- Always call `UI.closeMobileMenu()` and update `<title>` in route handlers
- Keep functions organized by module files in `app/src/`
- All magic numbers go in `CONSTANTS` object in `constants.js`

### Architecture
- **ES6 Modules**: Clean separation of concerns across multiple files
- **Microtastic**: Handles dependency bundling only (fuse.js, marked, prismjs)
- **Local Assets**: Fonts and Prism themes bundled from npm, not CDN
- **Custom YAML Parser**: Minimal ~4KB parser for content.yaml
- **No frameworks**: Vanilla JavaScript with modern features
- **Template literals**: Secure HTML generation with auto-escaping

### Don't
- Don't introduce frameworks or heavy build steps
- Don't concatenate raw HTML strings; don't bypass escaping without `safe()`
- Don't use hash routing; keep the `URLSearchParams` pattern
- Don't modify Microtastic config without good reason
- Don't export individual functions from modules (use namespace pattern)
- Don't create new modules without following the namespace pattern

### Quality Gate
- Format: `npm run format` or `biome format --write .`
- Lint: `npm run check` or `biome check .`
- Test: `npm test` or `node --test 'tests/**/*.test.js'`
- **All changes must pass lint checks AND tests before build**
- Production build runs: linting → tests → build (`npm run prod`)
- Update `README.md` if adding features or changing setup

### Key Patterns
- Templates: `Templates.* = (args) => html\`...\`` (in `templates.js`)
- Markdown: `MarkdownLoader.loadAsHtml(path)` for pages/posts (in `markdown.js`)
- Search: `Search.init()` with 300ms debounce (in `search.js`)
- Comments: `Templates.giscusComments(data?.site?.comments, "blog"|"projects")`
- Theme: `Context.applyColorScheme()` for colors, Prism themes loaded via local CSS
- i18n: `i18n.t('key')` for all user-facing strings (in `i18n.js`)
- Routing: `Router.handleRoute()` for navigation, `RouterEvents.navigateToRoute(href)` for programmatic navigation
- UI: `UI.closeMobileMenu()`, `UI.initCopyCodeButtons()`, etc.

### Module Structure

**Namespace Pattern Modules** (export single object):
- `app/src/ui.js` - `UI` namespace for UI interactions, mobile menu, dropdowns
- `app/src/loaders.js` - `Loaders` namespace for content loaders (blog, projects, pages)
- `app/src/context.js` - `Context` namespace for app state, data loading, theming
- `app/src/routing.js` - `Router` namespace for SPA routing, page navigation
- `app/src/layout.js` - `Layout` namespace for navbar and footer rendering
- `app/src/router-events.js` - `RouterEvents` namespace for routing event system
- `app/src/templates.js` - `Templates` namespace for HTML utilities and template functions
- `app/src/search.js` - `Search` namespace for Fuse.js search implementation
- `app/src/yaml-parser.js` - `YAMLParser` namespace for minimal YAML parser
- `app/src/markdown.js` - `MarkdownLoader` namespace for markdown loading
- `app/src/prism-loader.js` - `PrismLoader` namespace for syntax highlighting
- `app/src/i18n.js` - `i18n` namespace for internationalization
- `app/src/constants.js` - `CONSTANTS` object for configuration

**Other Modules**:
- `app/src/main.js` - entry point, initialization
- `app/src/dependencies/` - bundled npm packages (managed by Microtastic)

### Files & Directories
- `app/index.html` - main HTML entry point
- `app/src/` - all JavaScript modules
- `app/data/content.yaml` - all content + config
- `app/data/pages/` - markdown pages
- `app/data/blog/` - markdown blog posts
- `app/css/main.css` - all styles
- `app/fonts/` - web fonts (auto-generated, gitignored)
- `app/css/prism-themes/` - syntax highlighting themes (auto-generated, gitignored)
- `public/` - build output (gitignored)

### Development
- `npm install` - install dependencies
- `npm run prepare` - copy assets (fonts, Prism themes) + bundle dependencies
- `npm run copy-assets` - copy fonts and Prism themes from node_modules
- `npm run dev` - start dev server on port 8081
- `npm test` - run all tests (70 tests covering utils, templates, search, YAML parser, routing, markdown, i18n)
- `npm run prod` - production build (runs linting → tests → build)
